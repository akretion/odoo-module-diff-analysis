PR: https://github.com/odoo/odoo/pull/

From: 7978d4ba0f093c4b5400dbb1776ff5c0416e203b
From: Yannick Tivisse
Date: 2018-09-10 12:23:42

Structural Changes: 7
Total Changes: 106

Revert "[IMP] *: Define groups on res.users models"

This reverts commit 99f497b390e680629dce3a7e2e282ada74ee9884.

================================= pseudo patch: =================================

--- a/odoo/addons/base/data/ir_module_category_data.xml
+++ b/odoo/addons/base/data/ir_module_category_data.xml
@@ -178,6 +178,16 @@
             <field name="sequence">100</field>
         </record>
 
+        <record model="ir.module.category" id="module_category_usability">
+            <field name="name">Extra Rights</field>
+            <field name="sequence">101</field>
+        </record>
+
+        <record model="ir.module.category" id="module_category_extra">
+            <field name="name">Other Extra Rights</field>
+            <field name="sequence">102</field>
+        </record>
+
         <!-- add applications to base groups -->
         <record model="res.groups" id="group_erp_manager">
             <field name="category_id" ref="module_category_administration"/>

--- a/odoo/addons/base/data/res_users_demo.xml
+++ b/odoo/addons/base/data/res_users_demo.xml
@@ -72,9 +72,6 @@
             <field name="groups_id" eval="[(5,)]"/><!-- Avoid auto-including this user in any default group -->
         </record>
 
-        <record id="base.group_user" model="res.groups"><!-- Remove the demo user for the internal_user group -->
-            <field name="users" eval="[(3,ref('demo_user0'))]"/>
-        </record>
         <record id="base.group_portal" model="res.groups"><!-- Add the demo user to the portal (and therefore to the portal member group) -->
             <field name="users" eval="[(4,ref('demo_user0'))]"/>
         </record>

--- a/odoo/addons/base/models/res_users.py
+++ b/odoo/addons/base/models/res_users.py
@@ -222,36 +222,6 @@ class Users(models.Model):
     name = fields.Char(related='partner_id.name', inherited=True)
     email = fields.Char(related='partner_id.email', inherited=True)
 
-    group_base_user = fields.Selection(
-        selection=lambda self: self._get_group_selection('base.module_category_user_type'),
-        string="User type", compute='_compute_groups_id', inverse='_inverse_groups_id',
-        category_xml_id='base.module_category_user_type')
-
-    group_administration_user = fields.Selection(
-        selection=lambda self: self._get_group_selection('base.module_category_administration'),
-        string="Administration", compute='_compute_groups_id', inverse='_inverse_groups_id',
-        category_xml_id='base.module_category_administration')
-
-    has_group_multi_company = fields.Boolean(
-        'Multi Companies', compute='_compute_groups_id', inverse='_inverse_groups_id',
-        group_xml_id='base.group_multi_company')
-
-    has_group_multi_currency = fields.Boolean(
-        'Multi Currencies', compute='_compute_groups_id', inverse='_inverse_groups_id',
-        group_xml_id='base.group_multi_currency')
-
-    has_group_no_one = fields.Boolean(
-        'Technical Features', compute='_compute_groups_id', inverse='_inverse_groups_id',
-        group_xml_id='base.group_no_one')
-
-    has_group_partner_manager = fields.Boolean(
-        'Contact Creation', compute='_compute_groups_id', inverse='_inverse_groups_id',
-        group_xml_id='base.group_partner_manager')
-
-    has_group_private_addresses = fields.Boolean(
-        'Access to Private Addresses', compute='_compute_groups_id', inverse='_inverse_groups_id',
-        group_xml_id='base.group_private_addresses')
-
     _sql_constraints = [
         ('login_key', 'UNIQUE (login)',  'You can not have two users with the same login !')
     ]
@@ -751,7 +721,6 @@ class GroupsImplied(models.Model):
     @api.multi
     def write(self, values):
         res = super(GroupsImplied, self).write(values)
-
         if values.get('users') or values.get('implied_ids'):
             # add all implied groups (to all users of each group)
             for group in self:

--- a/odoo/addons/base/views/res_users_views.xml
+++ b/odoo/addons/base/views/res_users_views.xml
@@ -141,6 +141,11 @@
                             <field name="company_id" context="{'user_preference': 0}" groups="base.group_multi_company"/>
                         </div>
                         <group>
+                            <label for="groups_id" string="Access Rights"
+                                    attrs="{'invisible': [('id', '>', 0)]}" groups="base.group_no_one"/>
+                            <div attrs="{'invisible': [('id', '>', 0)]}" groups="base.group_no_one">
+                                <field name="groups_id" readonly="1" widget="many2many_tags" options="{'color_field': 'color'}" style="display: inline;"/> You will be able to define additional access rights by editing the newly created user under the Settings / Users menu.
+                            </div>
                             <field name="phone" widget="phone"/>
                             <field name="mobile" widget="phone"/>
                         </group>
@@ -185,40 +190,12 @@
                         </div>
                         <notebook colspan="4">
                             <page name="access_rights" string="Access Rights">
-                                <group string="User Type" name="user_type" groups="base.group_no_one">
-                                    <field name="group_base_user" groups="base.group_no_one"/>
-                                </group>
                                 <group string="Multi Companies" attrs="{'invisible': [('companies_count', '&lt;=', 1)]}">
                                     <field string="Allowed Companies" name="company_ids" widget="many2many_tags" options="{'no_create': True}"/>
                                     <field string="Current Company" name="company_id" context="{'user_preference': 0}"/>
                                     <field string="Companies count" name="companies_count" invisible="1"/>
                                 </group>
-                                <group string="Application Accesses" name="applications"/>
-                                <group string="Technical Settings" name="technical" groups="base.group_no_one" col="8">
-                                    <!-- TODO: Hide the no_one group -->
-                                    <label for="has_group_no_one" colspan="3"/>
-                                    <div>
-                                        <field name='has_group_no_one' colspan="1" class="oe_inline"/>
-                                    </div>
-                                </group>
-                                <group string="Extra Rights" name="extra" groups="base.group_no_one" col="8">
-                                    <label for="has_group_multi_company" colspan="3"/>
-                                    <div>
-                                        <field name='has_group_multi_company' colspan="1" class="oe_inline"/>
-                                    </div>
-                                    <label for="has_group_multi_currency" colspan="3"/>
-                                    <div>
-                                        <field name='has_group_multi_currency' colspan="1" class="oe_inline"/>
-                                    </div>
-                                    <label for="has_group_partner_manager" colspan="3"/>
-                                    <div>
-                                        <field name='has_group_partner_manager' colspan="1" class="oe_inline"/>
-                                    </div>
-                                    <label for="has_group_private_addresses" colspan="3"/>
-                                    <div>
-                                        <field name="has_group_private_addresses" colspan="1" class="oe_inline"/>
-                                    </div>
-                                </group>
+                                <field name="groups_id"/>
                             </page>
                             <page string="Preferences">
                                 <group>
@@ -235,27 +212,12 @@
                                     <field name="signature"/>
                                 </group>
                             </page>
-                            <page string="Groups" groups="base.group_no_one">
-                                <group>
-                                    <field name="groups_id"/>
-                                </group>
-                            </page>
                         </notebook>
                     </sheet>
                 </form>
             </field>
         </record>
-        <record id="res_users_view_form_administation" model="ir.ui.view">
-            <field name="name">res.users.view.form.administration</field>
-            <field name="model">res.users</field>
-            <field name="inherit_id" ref="view_users_form"/>
-            <field name="priority">1000</field>
-            <field name="arch" type="xml">
-                <group name="applications" position="inside">
-                    <field name="group_administration_user"/>
-                </group>
-            </field>
-        </record>
+
         <record id="view_users_tree" model="ir.ui.view">
             <field name="name">res.users.tree</field>
             <field name="model">res.users</field>
@@ -315,6 +277,16 @@
                 </search>
             </field>
         </record>
+        <record id="user_groups_view" model="ir.ui.view">
+            <field name="name">res.users.groups</field>
+            <field name="model">res.users</field>
+            <field name="inherit_id" ref="view_users_form"/>
+            <field name="arch" type="xml">
+                <!-- dummy, will be modified by groups -->
+                <field name="groups_id" position="after"/>
+            </field>
+        </record>
+        <!-- dummy update on group, to force the view above to be update -->
         <record model="res.groups" id="group_no_one"/>
         <record id="action_res_users" model="ir.actions.act_window">
             <field name="name">Users</field>
