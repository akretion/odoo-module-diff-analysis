PR: https://github.com/odoo/odoo/pull/86541

From: 8c534f87243d9a4810eb5eab8b8b783622146d04
From: Tom De Caluw√©
Date: 2022-08-16 15:49:46

Structural Changes: 5.9
Total Changes: 17

[IMP] website: add languages field in the website creation modal

Allow the user to select multiple languages in the website creation modal.

task-2745347

closes odoo/odoo#86541

Signed-off-by: Romain Derie (rde) <rde@odoo.com>

================================= pseudo patch: =================================

--- a/addons/website/models/res_config_settings.py
+++ b/addons/website/models/res_config_settings.py
@@ -43,7 +43,7 @@ class ResConfigSettings(models.TransientModel):
         readonly=False)
     website_language_count = fields.Integer(
         string='Number of languages',
-        compute='_compute_website_language_count',
+        related='website_id.language_count',
         readonly=True)
     website_default_lang_id = fields.Many2one(
         string='Default language',
@@ -207,11 +207,6 @@ class ResConfigSettings(models.TransientModel):
         elif self.website_default_lang_id not in language_ids:
             self.website_default_lang_id = language_ids[0]
 
-    @api.depends('language_ids')
-    def _compute_website_language_count(self):
-        for config in self:
-            config.website_language_count = len(config.language_ids)
-
     def action_website_create_new(self):
         return {
             'view_mode': 'form',

--- a/addons/website/models/website.py
+++ b/addons/website/models/website.py
@@ -68,7 +68,10 @@ class Website(models.Model):
     country_group_ids = fields.Many2many('res.country.group', 'website_country_group_rel', 'website_id', 'country_group_id',
                                          string='Country Groups', help='Used when multiple websites have the same domain.')
     company_id = fields.Many2one('res.company', string="Company", default=lambda self: self.env.company, required=True)
-    language_ids = fields.Many2many('res.lang', 'website_lang_rel', 'website_id', 'lang_id', 'Languages', default=_active_languages)
+    language_ids = fields.Many2many(
+        'res.lang', 'website_lang_rel', 'website_id', 'lang_id', string="Languages",
+        default=_active_languages, required=True)
+    language_count = fields.Integer('Number of languages', compute='_compute_language_count')
     default_lang_id = fields.Many2one('res.lang', string="Default Language", default=_default_language, required=True)
     auto_redirect_lang = fields.Boolean('Autoredirect Language', default=True, help="Should users be redirected to their browser's language")
     cookies_bar = fields.Boolean('Cookies Bar', help="Display a customizable cookies bar on your website.")
@@ -152,6 +155,11 @@ class Website(models.Model):
         for website in self:
             website.has_social_default_image = bool(website.social_default_image)
 
+    @api.depends('language_ids')
+    def _compute_language_count(self):
+        for website in self:
+            website.language_count = len(website.language_ids)
+
     def _compute_menu(self):
         for website in self:
             menus = self.env['website.menu'].browse(website._get_menu_ids())
