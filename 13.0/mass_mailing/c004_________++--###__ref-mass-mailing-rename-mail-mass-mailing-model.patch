PR: https://github.com/odoo/odoo/pull/

From: 49d2899fbd3e9b1c3b689fd5bdeb7f4fa0f6bfd1
From: Thibault DelavallÃ©e
Date: 2019-07-17 15:50:33

Structural Changes: 9
Total Changes: 1526

[REF] mass_mailing: rename mail.mass_mailing model

PURPOSE

Mass mailing is currently a bit messy. As SMS will be added as a way to notify
people in mass through SMS let us take this opportunity to somehow clean this
application: organization, light code cleaning, model renaming.

SPECIFICATIONS

Rename mail.mass_mailing model to mailing.mailing. Rationale :

  * mailing is now a prefix for mass mailing models;
  * mailing.mailing is easier to read / find / understand;

Note that mail.mass_mailing.campaign is not updated as it is likely to be
removed soon and replaced by simple utm.campaign model.

MIGRATION

mail.mass_mailing model -> mailing.mailing
mail_mass_mailing table -> mailing_mailing

LINKS

Task ID 2037906
Preparing task ID 1997464 (SMS addition in mass mailing)
PR #34938

================================= pseudo patch: =================================

--- a/addons/mass_mailing/models/__init__.py
+++ b/addons/mass_mailing/models/__init__.py
@@ -4,8 +4,8 @@
 from . import link_tracker
 from . import mailing_contact
 from . import mailing_list
-from . import mass_mailing
 from . import mailing_trace
+from . import mailing
 from . import mail_mail
 from . import mail_template
 from . import mail_thread

--- a/addons/mass_mailing/models/link_tracker.py
+++ b/addons/mass_mailing/models/link_tracker.py
@@ -7,7 +7,7 @@ from odoo import api, fields, models
 class LinkTracker(models.Model):
     _inherit = "link.tracker"
 
-    mass_mailing_id = fields.Many2one('mail.mass_mailing', string='Mass Mailing')
+    mass_mailing_id = fields.Many2one('mailing.mailing', string='Mass Mailing')
     mass_mailing_campaign_id = fields.Many2one('mail.mass_mailing.campaign', string='Mass Mailing Campaign')
 
 
@@ -15,7 +15,7 @@ class LinkTrackerClick(models.Model):
     _inherit = "link.tracker.click"
 
     mailing_trace_id = fields.Many2one('mailing.trace', string='Mail Statistics')
-    mass_mailing_id = fields.Many2one('mail.mass_mailing', string='Mass Mailing')
+    mass_mailing_id = fields.Many2one('mailing.mailing', string='Mass Mailing')
     mass_mailing_campaign_id = fields.Many2one('mail.mass_mailing.campaign', string='Mass Mailing Campaign')
 
     def _prepare_click_values_from_route(self, **route_values):

--- a/addons/mass_mailing/models/mail_mail.py
+++ b/addons/mass_mailing/models/mail_mail.py
@@ -13,7 +13,7 @@ class MailMail(models.Model):
     """Add the mass mailing campaign data to mail"""
     _inherit = ['mail.mail']
 
-    mailing_id = fields.Many2one('mail.mass_mailing', string='Mass Mailing')
+    mailing_id = fields.Many2one('mailing.mailing', string='Mass Mailing')
     mailing_trace_ids = fields.One2many('mailing.trace', 'mail_mail_id', string='Statistics')
 
     @api.model

--- a/addons/mass_mailing/models/mass_mailing.py
+++ b/addons/mass_mailing/models/mailing.py
@@ -81,7 +81,7 @@ class MassMailingCampaign(models.Model):
         'mailing.tag', 'mail_mass_mailing_tag_rel',
         'tag_id', 'campaign_id', string='Tags')
     mass_mailing_ids = fields.One2many(
-        'mail.mass_mailing', 'mass_mailing_campaign_id',
+        'mailing.mailing', 'mass_mailing_campaign_id',
         string='Mass Mailings')
     unique_ab_testing = fields.Boolean(string='Allow A/B Testing', default=False,
         help='If checked, recipients will be mailed only once for the whole campaign. '
@@ -154,7 +154,7 @@ class MassMailingCampaign(models.Model):
             self.browse(row.pop('campaign_id')).update(row)
 
     def _compute_total_mailings(self):
-        campaign_data = self.env['mail.mass_mailing'].read_group(
+        campaign_data = self.env['mailing.mailing'].read_group(
             [('mass_mailing_campaign_id', 'in', self.ids)],
             ['mass_mailing_campaign_id'], ['mass_mailing_campaign_id'])
         mapped_data = dict([(c['mass_mailing_campaign_id'][0], c['mass_mailing_campaign_id_count']) for c in campaign_data])
@@ -184,7 +184,7 @@ class MassMailingCampaign(models.Model):
 class MassMailing(models.Model):
     """ MassMailing models a wave of emails for a mass mailign campaign.
     A mass mailing is an occurence of sending emails. """
-    _name = 'mail.mass_mailing'
+    _name = 'mailing.mailing'
     _description = 'Mass Mailing'
     # number of periods for tracking mail_mail statistics
     _period_number = 6
@@ -313,7 +313,7 @@ class MassMailing(models.Model):
             FROM
                 mailing_trace s
             RIGHT JOIN
-                mail_mass_mailing m
+                mailing_mailing m
                 ON (m.id = s.mass_mailing_id)
             WHERE
                 m.id IN %s
@@ -409,7 +409,7 @@ class MassMailing(models.Model):
             return {
                 'type': 'ir.actions.act_window',
                 'view_mode': 'form',
-                'res_model': 'mail.mass_mailing',
+                'res_model': 'mailing.mailing',
                 'res_id': mass_mailing_copy.id,
                 'context': context,
             }
@@ -422,14 +422,14 @@ class MassMailing(models.Model):
             'name': _('Test Mailing'),
             'type': 'ir.actions.act_window',
             'view_mode': 'form',
-            'res_model': 'mail.mass_mailing.test',
+            'res_model': 'mailing.mailing.test',
             'target': 'new',
             'context': ctx,
         }
 
     def action_schedule_date(self):
         self.ensure_one()
-        action = self.env.ref('mass_mailing.mass_mailing_schedule_date_action').read()[0]
+        action = self.env.ref('mass_mailing.mailing_mailing_schedule_date_action').read()[0]
         action['context'] = dict(self.env.context, default_mass_mailing_id=self.id)
         return action
 

--- a/addons/mass_mailing/models/mailing_trace.py
+++ b/addons/mass_mailing/models/mailing_trace.py
@@ -29,7 +29,7 @@ class MailingTrace(models.Model):
     model = fields.Char(string='Document model')
     res_id = fields.Integer(string='Document ID')
     # campaign / wave data
-    mass_mailing_id = fields.Many2one('mail.mass_mailing', string='Mass Mailing', index=True)
+    mass_mailing_id = fields.Many2one('mailing.mailing', string='Mass Mailing', index=True)
     mass_mailing_campaign_id = fields.Many2one(
         related='mass_mailing_id.mass_mailing_campaign_id',
         string='Mass Mailing Campaign',
