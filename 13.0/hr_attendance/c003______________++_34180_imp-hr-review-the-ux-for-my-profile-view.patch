PR: https://github.com/odoo/odoo/pull/34180

From: e9d989827686d1089c1ea1c9a6b47b62a09e2de4
From: Kevin Baptiste
Date: 2019-07-18 10:27:50

Structural Changes: 6
Total Changes: 8

[IMP] hr: Review the UX for 'My Profile' view

1/ web: adapt formatDate to handle NaN values
DashboardRenderer might return NaN for `Date` or `DateTime` fields if
their original value is null or incorrect.

2/ hr: add job_title in demo data

3/ hr_recruitment: link employee in the chatter for new recruits

4/ hr: remove employee documents in the model

5/ hr_attendance: improve resiliency of relative_time

6/ hr: display manager on res_users

7/ hr: change Address Book to Employee Directory

TaskID: 2009111

closes odoo/odoo#34180

Signed-off-by: Yannick Tivisse (yti) <yti@odoo.com>

================================= pseudo patch: =================================

--- a/addons/hr_attendance/models/hr_employee.py
+++ b/addons/hr_attendance/models/hr_employee.py
@@ -13,9 +13,12 @@ class HrEmployeeBase(models.AbstractModel):
 
     attendance_ids = fields.One2many('hr.attendance', 'employee_id', help='list of attendances for the employee')
     last_attendance_id = fields.Many2one('hr.attendance', compute='_compute_last_attendance_id', store=True)
+    last_check_in = fields.Datetime(related='last_attendance_id.check_in', store=True)
+    last_check_out = fields.Datetime(related='last_attendance_id.check_out', store=True)
     attendance_state = fields.Selection(string="Attendance Status", compute='_compute_attendance_state', selection=[('checked_out', "Checked out"), ('checked_in', "Checked in")])
     hours_last_month = fields.Float(compute='_compute_hours_last_month')
     hours_today = fields.Float(compute='_compute_hours_today')
+    hours_last_month_display = fields.Char(compute='_compute_hours_last_month')
 
     def _compute_presence_state(self):
         """
@@ -42,6 +45,7 @@ class HrEmployeeBase(models.AbstractModel):
                 ('check_out', '<=', end),
             ])
             employee.hours_last_month = sum(attendances.mapped('worked_hours'))
+            employee.hours_last_month_display = "%g" % employee.hours_last_month
 
     def _compute_hours_today(self):
         now = fields.Datetime.now()

--- a/addons/hr_attendance/models/res_users.py
+++ b/addons/hr_attendance/models/res_users.py
@@ -8,7 +8,10 @@ class User(models.Model):
     _inherit = ['res.users']
 
     hours_last_month = fields.Float(related='employee_id.hours_last_month')
+    hours_last_month_display = fields.Char(related='employee_id.hours_last_month_display')
     attendance_state = fields.Selection(related='employee_id.attendance_state')
+    last_check_in = fields.Datetime(related='employee_id.last_attendance_id.check_in')
+    last_check_out = fields.Datetime(related='employee_id.last_attendance_id.check_out')
 
     def __init__(self, pool, cr):
         """ Override of __init__ to add access rights.
@@ -17,6 +20,7 @@ class User(models.Model):
         """
         attendance_readable_fields = [
             'hours_last_month',
+            'hours_last_month_display',
             'attendance_state',
         ]
         super(User, self).__init__(pool, cr)
