PR: https://github.com/odoo/odoo/pull/122085

From: 3c62ca1eb96d571b2b686b5caee370324c589ab4
From: Rémy Voet (ryv)
Date: 2023-06-28 15:41:19

Structural Changes: 2
Total Changes: 265

[REM] core: remove `name_get` API

Rationale
=========

Since v8, the `display_name` field is present on all models. By default,
`display_name` uses `name_get` which has pretty much the same purpose
(return record name used by the web client). Gradually, many (backend)
developers (and the ORM: https://github.com/odoo/odoo/commit/6da1c3ac4c036eac289597602976538e243cb939)
started using `display_name` (more convenient than
`record.name_get()[0][1]`) but it still had the `name_get` override.
It becomes more complex than necessary and poeple start to misunderstand
the two (and sometimes override both, leading to inconstiencies between
`display_name`/`name_get`).

To simplify the ORM and the API, we decided to keep only one of them,
the `display_name` field:
- It is much more convenient from a backend point of view
(`record.name_get()[0][1]` vs `record.display_name`)
- It is cached during the same transaction (and invalidated if
its dependencies change)
- It can be overridden like any other compute field (override
`_compute_display_name` with any extra dependencies)
- `name_get` is replaced by `read(['display_name'])`
(API perceptive), which can actually be more efficient
(if `display_name`'s depends are correct, the ORM will only fetch the
fields it needs instead of every prefetchable field)

Changes
=======

- Deprecates `name_get` for the v17 and based the method on
`display_name` (the opposite of before)
- Converts all usage of `name_get`
- Overrides of `name_get` are now overrides of `_compute_display_name`
- For `res.partner`, rename the field store `display_name` into
`complete_name` because `display_name` context-dependent and it makes
no sense to have a compute store that is context-dependent.
- Previously, it was possible to return multiple names for the same
record with `name_get`, but it was tricky and most of the usage of
this `name_get` didn't take this into account. The only example of
this is the `name_get` of `product.product`
(now use `", ".join(<names>)`).

Part-of: odoo/odoo#122085

================================= pseudo patch: =================================

--- a/odoo/addons/base/models/ir_fields.py
+++ b/odoo/addons/base/models/ir_fields.py
@@ -398,7 +398,7 @@ class IrFieldsConverter(models.AbstractModel):
         :param model: model to which the field belongs
         :param field: relational field for which references are provided
         :param subfield: a relational subfield allowing building of refs to
-                         existing records: ``None`` for a name_get/name_search,
+                         existing records: ``None`` for a name_search,
                          ``id`` for an external id and ``.id`` for a database
                          id
         :param value: value of the reference to match to an actual record
@@ -542,7 +542,7 @@ class IrFieldsConverter(models.AbstractModel):
         :return: the record subfield to use for referencing and a list of warnings
         :rtype: str, list
         """
-        # Can import by name_get, external id or database id
+        # Can import by display_name, external id or database id
         fieldset = set(record)
         if fieldset - REFERENCING_FIELDS:
             raise ValueError(

--- a/odoo/addons/base/models/ir_model.py
+++ b/odoo/addons/base/models/ir_model.py
@@ -371,11 +371,11 @@ class IrModel(models.Model):
     @api.model
     def name_create(self, name):
         """ Infer the model from the name. E.g.: 'My New Model' should become 'x_my_new_model'. """
-        vals = {
+        ir_model = self.create({
             'name': name,
             'model': 'x_' + '_'.join(name.lower().split(' ')),
-        }
-        return self.create(vals).name_get()[0]
+        })
+        return ir_model.id, ir_model.display_name
 
     def _reflect_model_params(self, model):
         """ Return the values to write to the database for the given model. """
@@ -1042,11 +1042,9 @@ class IrModelFields(models.Model):
             self.clear_caches()
         return res
 
-    def name_get(self):
-        res = []
+    def _compute_display_name(self):
         for field in self:
-            res.append((field.id, '%s (%s)' % (field.field_description, field.model)))
-        return res
+            field.display_name = f'{field.field_description} ({field.model})'
 
     def _reflect_field_params(self, field, model_id):
         """ Return the values to write to the database for the given field. """
@@ -1998,22 +1996,14 @@ class IrModelData(models.Model):
                            self._table, ['model', 'res_id'])
         return res
 
-    def name_get(self):
-        model_id_name = defaultdict(dict)       # {res_model: {res_id: name}}
-        for xid in self:
-            model_id_name[xid.model][xid.res_id] = None
-
-        # fill in model_id_name with name_get() of corresponding records
-        for model, id_name in model_id_name.items():
-            try:
-                ng = self.env[model].browse(id_name).name_get()
-                id_name.update(ng)
-            except Exception:
-                pass
-
-        # return results, falling back on complete_name
-        return [(xid.id, model_id_name[xid.model][xid.res_id] or xid.complete_name)
-                for xid in self]
+    def _compute_display_name(self):
+        for model, model_data_records in self.grouped('model').items():
+            records = self.env[model].browse(model_data_records.mapped('res_id'))
+            for xid, target_record in zip(model_data_records, records):
+                try:
+                    xid.display_name = target_record.display_name or xid.complete_name
+                except Exception:  # pylint: disable=broad-except
+                    xid.display_name = xid.complete_name
 
     # NEW V8 API
     @api.model

--- a/odoo/addons/base/models/ir_qweb_fields.py
+++ b/odoo/addons/base/models/ir_qweb_fields.py
@@ -777,16 +777,15 @@ class Contact(models.AbstractModel):
             opsep = Markup('<br/>')
 
         value = value.sudo().with_context(show_address=True)
-        name_get = value.name_get()[0][1]
         # Avoid having something like:
-        # name_get = 'Foo\n  \n' -> This is a res.partner with a name and no address
+        # display_name = 'Foo\n  \n' -> This is a res.partner with a name and no address
         # That would return markup('<br/>') as address. But there is no address set.
-        if any(elem.strip() for elem in name_get.split("\n")[1:]):
-            address = opsep.join(name_get.split("\n")[1:]).strip()
+        if any(elem.strip() for elem in value.display_name.split("\n")[1:]):
+            address = opsep.join(value.display_name.split("\n")[1:]).strip()
         else:
             address = ''
         val = {
-            'name': name_get.split("\n")[0],
+            'name': value.display_name.split("\n")[0],
             'address': address,
             'phone': value.phone,
             'mobile': value.mobile,

--- a/odoo/addons/base/models/ir_ui_menu.py
+++ b/odoo/addons/base/models/ir_ui_menu.py
@@ -155,8 +155,9 @@ class IrUiMenu(models.Model):
         # to be consistent with search() above
         return len(self.search(domain, limit=limit))
 
-    def name_get(self):
-        return [(menu.id, menu._get_full_name()) for menu in self]
+    def _compute_display_name(self):
+        for menu in self:
+            menu.display_name = menu._get_full_name()
 
     @api.model_create_multi
     def create(self, vals_list):

--- a/odoo/addons/base/models/res_bank.py
+++ b/odoo/addons/base/models/res_bank.py
@@ -30,12 +30,10 @@ class Bank(models.Model):
     active = fields.Boolean(default=True)
     bic = fields.Char('Bank Identifier Code', index=True, help="Sometimes called BIC or Swift.")
 
-    def name_get(self):
-        result = []
+    def _compute_display_name(self):
         for bank in self:
             name = (bank.name or '') + (bank.bic and (' - ' + bank.bic) or '')
-            result.append((bank.id, name))
-        return result
+            bank.display_name = name
 
     @api.model
     def _name_search(self, name, domain=None, operator='ilike', limit=None, order=None):
@@ -113,9 +111,9 @@ class ResPartnerBank(models.Model):
         """
         return 'bank'
 
-    def name_get(self):
-        return [(acc.id, '{} - {}'.format(acc.acc_number, acc.bank_id.name) if acc.bank_id else acc.acc_number)
-                for acc in self]
+    def _compute_display_name(self):
+        for acc in self:
+            acc.display_name = f'{acc.acc_number} - {acc.bank_id.name}' if acc.bank_id else acc.acc_number
 
     @api.model
     def _search(self, domain, offset=0, limit=None, order=None, access_rights_uid=None):

--- a/odoo/addons/base/models/res_config.py
+++ b/odoo/addons/base/models/res_config.py
@@ -639,12 +639,11 @@ class ResConfigSettings(models.TransientModel, ResConfigModuleInstallationMixin)
             return actions.read()[0]
         return {}
 
-    def name_get(self):
-        """ Override name_get method to return an appropriate configuration wizard
+    def _compute_display_name(self):
+        """ Override display_name method to return an appropriate configuration wizard
         name, and not the generated name."""
         action = self.env['ir.actions.act_window'].search([('res_model', '=', self._name)], limit=1)
-        name = action.name or self._name
-        return [(record.id, name) for record in self]
+        self.display_name = action.name or self._name
 
     @api.model
     def get_option_path(self, menu_xml_id):

--- a/odoo/addons/base/models/res_country.py
+++ b/odoo/addons/base/models/res_country.py
@@ -193,8 +193,6 @@ class CountryState(models.Model):
             if state_id not in first_state_ids
         ]
 
-    def name_get(self):
-        result = []
+    def _compute_display_name(self):
         for record in self:
-            result.append((record.id, "{} ({})".format(record.name, record.country_id.code)))
-        return result
+            record.display_name = f"{record.name} ({record.country_id.code})"

--- a/odoo/addons/base/models/res_currency.py
+++ b/odoo/addons/base/models/res_currency.py
@@ -156,9 +156,6 @@ class Currency(models.Model):
         for currency in self:
             currency.date = currency.rate_ids[:1].name
 
-    def name_get(self):
-        return [(currency.id, tools.ustr(currency.name)) for currency in self]
-
     def amount_to_text(self, amount):
         self.ensure_one()
         def _num2words(number, lang):

--- a/odoo/addons/base/models/res_partner.py
+++ b/odoo/addons/base/models/res_partner.py
@@ -128,25 +128,23 @@ class PartnerCategory(models.Model):
         if not self._check_recursion():
             raise ValidationError(_('You can not create recursive tags.'))
 
-    def name_get(self):
+    def _compute_display_name(self):
         """ Return the categories' display name, including their direct
             parent by default.
         """
-        res = []
         for category in self:
             names = []
             current = category
             while current:
                 names.append(current.name)
                 current = current.parent_id
-            res.append((category.id, ' / '.join(reversed(names))))
-        return res
+            category.display_name = ' / '.join(reversed(names))
 
     @api.model
     def _name_search(self, name, domain=None, operator='ilike', limit=None, order=None):
         domain = domain or []
         if name:
-            # Be sure name_search is symetric to name_get
+            # Be sure name_search is symetric to display_name
             name = name.split(' / ')[-1]
             domain = [('name', operator, name)] + domain
         return self._search(domain, limit=limit, order=order)
@@ -165,8 +163,11 @@ class Partner(models.Model):
     _description = 'Contact'
     _inherit = ['format.address.mixin', 'avatar.mixin']
     _name = "res.partner"
-    _order = "display_name, id"
-    _rec_names_search = ['display_name', 'email', 'ref', 'vat', 'company_registry']  # TODO vat must be sanitized the same way for storing/searching
+    _order = "complete_name, id"
+    _rec_names_search = ['complete_name', 'email', 'ref', 'vat', 'company_registry']  # TODO vat must be sanitized the same way for storing/searching
+
+    # the partner types that must be added to a partner's complete name, like "Delivery"
+    _complete_name_displayed_types = ('invoice', 'delivery', 'other')
 
     def _default_category(self):
         return self.env['res.partner.category'].browse(self._context.get('category_id'))
@@ -189,7 +190,7 @@ class Partner(models.Model):
         return values
 
     name = fields.Char(index=True, default_export_compatible=True)
-    display_name = fields.Char(compute='_compute_display_name', recursive=True, store=True, index=True)
+    complete_name = fields.Char(compute='_compute_complete_name', store=True, index=True)
     date = fields.Date(index=True)
     title = fields.Many2one('res.partner.title')
     parent_id = fields.Many2one('res.partner', string='Related Company', index=True)
@@ -332,12 +333,22 @@ class Partner(models.Model):
             return "base/static/img/money.png"
         return super()._avatar_get_placeholder_path()
 
-    @api.depends('is_company', 'name', 'parent_id.display_name', 'type', 'company_name', 'commercial_company_name')
-    def _compute_display_name(self):
-        # retrieve name_get() without any fancy feature
-        names = dict(self.with_context({}).name_get())
+    @api.depends('is_company', 'name', 'parent_id.name', 'type', 'company_name', 'commercial_company_name')
+    def _compute_complete_name(self):
+        displayed_types = self._complete_name_displayed_types
+        # determine the labels of partner types to be included
+        # as 'displayed_types' (without user lang to avoid context dependency)
+        type_description = dict(self._fields['type']._description_selection(self.with_context({}).env))
+
         for partner in self:
-            partner.display_name = names.get(partner.id)
+            name = partner.name or ''
+            if partner.company_name or partner.parent_id:
+                if not name and partner.type in displayed_types:
+                    name = type_description[partner.type]
+                if not partner.is_company:
+                    name = f"{partner.commercial_company_name or partner.sudo().parent_id.name}, {name}"
+
+            partner.complete_name = name.strip()
 
     @api.depends('lang')
     def _compute_active_lang_count(self):
@@ -803,39 +814,25 @@ class Partner(models.Model):
                 'target': 'new',
                 }
 
-    def _get_contact_name(self, partner, name):
-        return "%s, %s" % (partner.commercial_company_name or partner.sudo().parent_id.name, name)
-
-    def _get_name(self):
-        """ Utility method to allow name_get to be overrided without re-browse the partner """
-        partner = self
-        name = partner.name or ''
-
-        if partner.company_name or partner.parent_id:
-            if not name and partner.type in ['invoice', 'delivery', 'other']:
-                name = dict(self.fields_get(['type'])['type']['selection'])[partner.type]
-            if not partner.is_company:
-                name = self._get_contact_name(partner, name)
-        if self._context.get('show_address'):
-            name = name + "\n" + partner._display_address(without_company=True)
-        name = re.sub(r'\s+\n', '\n', name)
-        if self._context.get('partner_show_db_id'):
-            name = "%s (%s)" % (name, partner.id)
-        if self._context.get('address_inline'):
-            splitted_names = name.split("\n")
-            name = ", ".join([n for n in splitted_names if n.strip()])
-        if self._context.get('show_email') and partner.email:
-            name = "%s <%s>" % (name, partner.email)
-        if self._context.get('show_vat') and partner.vat:
-            name = "%s ‒ %s" % (name, partner.vat)
-        return name.strip()
-
-    def name_get(self):
-        res = []
+    @api.depends('complete_name')
+    @api.depends_context('show_address', 'partner_show_db_id', 'address_inline', 'show_email', 'show_vat')
+    def _compute_display_name(self):
         for partner in self:
-            name = partner._get_name()
-            res.append((partner.id, name))
-        return res
+            name = partner.complete_name
+            if partner._context.get('show_address'):
+                name = name + "\n" + partner._display_address(without_company=True)
+            name = re.sub(r'\s+\n', '\n', name)
+            if partner._context.get('partner_show_db_id'):
+                name = f"{name} ({partner.id})"
+            if partner._context.get('address_inline'):
+                splitted_names = name.split("\n")
+                name = ", ".join([n for n in splitted_names if n.strip()])
+            if partner._context.get('show_email') and partner.email:
+                name = f"{name} <{partner.email}>"
+            if partner._context.get('show_vat') and partner.vat:
+                name = f"{name} ‒ {partner.vat}"
+
+            partner.display_name = name.strip()
 
     def _parse_partner_name(self, text):
         """ Parse partner name (given by text) in order to find a name and an
@@ -891,7 +888,7 @@ class Partner(models.Model):
         if email:  # keep default_email in context
             create_values['email'] = email
         partner = self.create(create_values)
-        return partner.name_get()[0]
+        return partner.id, partner.display_name
 
     @api.model
     def _search(self, domain, offset=0, limit=None, order=None, access_rights_uid=None):

--- a/odoo/addons/base/tests/test_deprecation.py
+++ b/odoo/addons/base/tests/test_deprecation.py
@@ -27,3 +27,12 @@ class TestModelDeprecations(TransactionCase):
                     if module:
                         msg += f" in {module}"
                     self.fail(msg)
+
+    def test_name_get(self):
+        for model_name, Model in self.registry.items():
+            with self.subTest(model=model_name):
+                # name_get should exist but define by BaseModel
+                module = inspect.getmodule(Model.name_get)
+                if module.__name__ == 'odoo.models':
+                    continue
+                self.fail(f"Deprecated name_get method found on {model_name} in {module.__name__}, you should override `_compute_display_name` instead")

--- a/odoo/addons/base/tests/test_expression.py
+++ b/odoo/addons/base/tests/test_expression.py
@@ -1127,7 +1127,7 @@ class TestQueries(TransactionCase):
                     )
                 )
             )
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             Model.search(domain)
 
@@ -1139,7 +1139,7 @@ class TestQueries(TransactionCase):
             SELECT "res_partner"."id"
             FROM "res_partner"
             WHERE (("res_partner"."active" = %s) AND ("res_partner"."name"::text LIKE %s))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             Model.search([('name', 'like', 'foo')])
 
@@ -1296,7 +1296,7 @@ class TestMany2one(TransactionCase):
             SELECT "res_partner"."id"
             FROM "res_partner"
             WHERE ("res_partner"."company_id" = %s)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id', '=', self.company.id)])
 
@@ -1308,7 +1308,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_company"
                 WHERE ("res_company"."name"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.name', 'like', self.company.name)])
 
@@ -1324,7 +1324,7 @@ class TestMany2one(TransactionCase):
                     WHERE ("res_partner"."name"::text LIKE %s)
                 ))
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.partner_id.name', 'like', self.company.name)])
 
@@ -1340,7 +1340,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_country"
                 WHERE ("res_country"."code"::text LIKE %s)
             )))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([
                 '|',
@@ -1359,7 +1359,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_company"
                 WHERE (("res_company"."active" = %s) AND ("res_company"."name"::text LIKE %s))
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             company_ids = self.company._search([('name', 'like', self.company.name)], order='id')
             self.Partner.search([('company_id', 'in', company_ids)])
@@ -1375,7 +1375,7 @@ class TestMany2one(TransactionCase):
                 ORDER BY "res_company"."id"
                 LIMIT 1
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             company_ids = self.company._search([('name', 'like', self.company.name)], order='id', limit=1)
             self.Partner.search([('company_id', 'in', company_ids)])
@@ -1390,7 +1390,7 @@ class TestMany2one(TransactionCase):
             SELECT "res_partner"."id"
             FROM "res_partner"
             WHERE ("res_partner"."company_id" IN %s)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             company_ids = self.company._search([('name', 'like', self.company.name)], order='id')
             company_ids = tuple(company_ids)
@@ -1406,7 +1406,7 @@ class TestMany2one(TransactionCase):
             SELECT "res_partner"."id"
             FROM "res_partner"
             WHERE ("res_partner"."company_id" IN %s)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             companies = self.company.search([('name', 'like', self.company.name)], order='id')
             company_ids = companies._as_query(ordered=False)
@@ -1424,7 +1424,7 @@ class TestMany2one(TransactionCase):
             LEFT JOIN "res_company" AS "res_partner__company_id" ON
                 ("res_partner"."company_id" = "res_partner__company_id"."id")
             WHERE ("res_partner__company_id"."name"::text LIKE %s)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.name', 'like', self.company.name)])
 
@@ -1438,7 +1438,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_partner"
                 WHERE ("res_partner"."name"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.partner_id.name', 'like', self.company.name)])
 
@@ -1457,7 +1457,7 @@ class TestMany2one(TransactionCase):
                     ("res_company"."partner_id" = "res_company__partner_id"."id")
                 WHERE ("res_company__partner_id"."name"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.partner_id.name', 'like', self.company.name)])
 
@@ -1474,7 +1474,7 @@ class TestMany2one(TransactionCase):
             LEFT JOIN "res_partner" AS "res_partner__company_id__partner_id" ON
                 ("res_partner__company_id"."partner_id" = "res_partner__company_id__partner_id"."id")
             WHERE ("res_partner__company_id__partner_id"."name"::text LIKE %s)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id.partner_id.name', 'like', self.company.name)])
 
@@ -1496,7 +1496,7 @@ class TestMany2one(TransactionCase):
                 ("res_partner"."company_id" = "res_partner__company_id"."id")
             WHERE (("res_partner__company_id"."name"::text LIKE %s)
                 OR ("res_partner__country_id"."code"::text LIKE %s))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([
                 '|',
@@ -1515,7 +1515,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_company"
                 WHERE ("res_company"."name"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id', 'like', self.company.name)])
 
@@ -1527,7 +1527,7 @@ class TestMany2one(TransactionCase):
                 FROM "res_company"
                 WHERE (("res_company"."name"::text not like %s) OR "res_company"."name" IS NULL))
             ) OR "res_partner"."company_id" IS NULL)
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('company_id', 'not like', "blablabla")])
 
@@ -1556,7 +1556,7 @@ class TestOne2many(TransactionCase):
             WHERE ("res_partner"."id" IN (
                 SELECT "partner_id" FROM "res_partner_bank" WHERE "id" IN %s
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('bank_ids', 'in', self.partner.bank_ids.ids)])
 
@@ -1568,7 +1568,7 @@ class TestOne2many(TransactionCase):
                 FROM "res_partner_bank"
                 WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('bank_ids.sanitized_acc_number', 'like', '12')])
 
@@ -1584,7 +1584,7 @@ class TestOne2many(TransactionCase):
                     WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)
                 )) AND "res_partner"."parent_id" IS NOT NULL
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('child_ids.bank_ids.sanitized_acc_number', 'like', '12')])
 
@@ -1601,7 +1601,7 @@ class TestOne2many(TransactionCase):
             WHERE ("res_partner"."id" IN (
                 SELECT "partner_id" FROM "res_partner_bank" WHERE "id" IN %s
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('bank_ids', 'in', self.partner.bank_ids.ids)])
 
@@ -1613,7 +1613,7 @@ class TestOne2many(TransactionCase):
                 FROM "res_partner_bank"
                 WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('bank_ids.sanitized_acc_number', 'like', '12')])
 
@@ -1629,7 +1629,7 @@ class TestOne2many(TransactionCase):
                 FROM "res_partner_bank"
                 WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)
             )))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([
                 ('bank_ids.sanitized_acc_number', 'like', '12'),
@@ -1647,7 +1647,7 @@ class TestOne2many(TransactionCase):
                                  FROM "res_partner_bank"
                                  WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)))
                              )))
-            ORDER BY "res_partner"."display_name",
+            ORDER BY "res_partner"."complete_name",
                      "res_partner"."id"
         ''']):
             self.Partner.search([('child_ids.bank_ids.sanitized_acc_number', 'like', '12')])
@@ -1678,7 +1678,7 @@ class TestOne2many(TransactionCase):
                     )
                 ))
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('child_ids.bank_ids.id', 'in', self.partner.bank_ids.ids)])
 
@@ -1704,7 +1704,7 @@ class TestOne2many(TransactionCase):
                     "res_partner__state_id__country_id"."code"::text LIKE %s
                 ))
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('child_ids.state_id.country_id.code', 'like', 'US')])
 
@@ -1719,7 +1719,7 @@ class TestOne2many(TransactionCase):
                 FROM "res_partner_bank"
                 WHERE ("res_partner_bank"."sanitized_acc_number"::text LIKE %s)
             ))
-            ORDER BY "res_partner"."display_name", "res_partner"."id"
+            ORDER BY "res_partner"."complete_name", "res_partner"."id"
         ''']):
             self.Partner.search([('bank_ids', 'like', '12')])
 

--- a/odoo/addons/base/tests/test_res_config.py
+++ b/odoo/addons/base/tests/test_res_config.py
@@ -225,7 +225,7 @@ class TestResConfigExecute(TransactionCase):
         settings.set_values()
 
         # Check user has access to all models of relational fields in view
-        # because the webclient makes a name_get request for all specified records
+        # because the webclient makes a read of display_name request for all specified records
         # even if they are not shown to the user.
         settings_view_arch = etree.fromstring(settings.get_view(view_id=self.settings_view.id)['arch'])
         seen_fields = set()

--- a/odoo/addons/base/tests/test_res_partner.py
+++ b/odoo/addons/base/tests/test_res_partner.py
@@ -27,21 +27,21 @@ class TestPartner(TransactionCase):
         ns_res = self.env['res.partner'].with_user(public_user).sudo().name_search('Vlad', args=[('user_ids.email', 'ilike', 'vlad')])
         self.assertEqual(set(i[0] for i in ns_res), set(test_user.partner_id.ids))
 
-    def test_name_get(self):
-        """ Check name_get on partner, especially with different context
-        Check name_get correctly return name with context. """
+    def test_display_name(self):
+        """ Check display_name on partner, especially with different context
+        Check display_name correctly return name with context. """
         test_partner_jetha = self.env['res.partner'].create({'name': 'Jethala', 'street': 'Powder gali', 'street2': 'Gokuldham Society'})
         test_partner_bhide = self.env['res.partner'].create({'name': 'Atmaram Bhide'})
 
-        res_jetha = test_partner_jetha.with_context(show_address=1).name_get()
-        self.assertEqual(res_jetha[0][1], "Jethala\nPowder gali\nGokuldham Society", "name should contain comma separated name and address")
-        res_bhide = test_partner_bhide.with_context(show_address=1).name_get()
-        self.assertEqual(res_bhide[0][1], "Atmaram Bhide", "name should contain only name if address is not available, without extra commas")
+        res_jetha = test_partner_jetha.with_context(show_address=1).display_name
+        self.assertEqual(res_jetha, "Jethala\nPowder gali\nGokuldham Society", "name should contain comma separated name and address")
+        res_bhide = test_partner_bhide.with_context(show_address=1).display_name
+        self.assertEqual(res_bhide, "Atmaram Bhide", "name should contain only name if address is not available, without extra commas")
 
-        res_jetha = test_partner_jetha.with_context(show_address=1, address_inline=1).name_get()
-        self.assertEqual(res_jetha[0][1], "Jethala, Powder gali, Gokuldham Society", "name should contain comma separated name and address")
-        res_bhide = test_partner_bhide.with_context(show_address=1, address_inline=1).name_get()
-        self.assertEqual(res_bhide[0][1], "Atmaram Bhide", "name should contain only name if address is not available, without extra commas")
+        res_jetha = test_partner_jetha.with_context(show_address=1, address_inline=1).display_name
+        self.assertEqual(res_jetha, "Jethala, Powder gali, Gokuldham Society", "name should contain comma separated name and address")
+        res_bhide = test_partner_bhide.with_context(show_address=1, address_inline=1).display_name
+        self.assertEqual(res_bhide, "Atmaram Bhide", "name should contain only name if address is not available, without extra commas")
 
     def test_company_change_propagation(self):
         """ Check propagation of company_id across children """
@@ -182,8 +182,7 @@ class TestPartner(TransactionCase):
         partner_merge_wizard = self.env['base.partner.merge.automatic.wizard'].with_context(
             {'partner_show_db_id': True, 'default_dst_partner_id': test_partner}).new()
         self.assertEqual(
-            partner_merge_wizard.dst_partner_id.name_get(),
-            [(test_partner.id, expected_partner_name)],
+            partner_merge_wizard.dst_partner_id.display_name, expected_partner_name,
             "'Destination Contact' name should contain db ID in brackets"
         )
 

--- a/odoo/addons/base/tests/test_translate.py
+++ b/odoo/addons/base/tests/test_translate.py
@@ -368,7 +368,7 @@ class TestTranslation(TransactionCase):
 
     def test_101_create_translated_record(self):
         category = self.customers.with_context({})
-        self.assertEqual(category.name, 'Customers', "Error in basic name_get")
+        self.assertEqual(category.name, 'Customers', "Error in basic name")
 
         category_fr = category.with_context({'lang': 'fr_FR'})
         self.assertEqual(category_fr.name, 'Clients', "Translation not found")

--- a/odoo/addons/base/views/res_partner_views.xml
+++ b/odoo/addons/base/views/res_partner_views.xml
@@ -430,7 +430,7 @@
             <field name="arch" type="xml">
                 <search string="Search Partner">
                     <field name="name"
-                       filter_domain="['|', '|', '|', '|', ('display_name', 'ilike', self), ('ref', '=', self), ('email', 'ilike', self), ('vat', 'ilike', self), ('company_registry', 'ilike', self)]"/>
+                       filter_domain="['|', '|', '|', '|', ('complete_name', 'ilike', self), ('ref', '=', self), ('email', 'ilike', self), ('vat', 'ilike', self), ('company_registry', 'ilike', self)]"/>
                     <field name="parent_id" domain="[('is_company', '=', True)]" operator="child_of"/>
                     <field name="email" filter_domain="[('email', 'ilike', self)]"/>
                     <field name="phone" filter_domain="['|', ('phone', 'ilike', self), ('mobile', 'ilike', self)]"/>
