PR: https://github.com/odoo/odoo/pull/156542

From: 2fbfd8a3089b5e5621e27c7d145228e9a46b065c
From: Andrzej(pian)
Date: 2024-03-06 08:35:39

Structural Changes: 4
Total Changes: 10

[FIX] stock: duplicating warehouse dependencies

Before this commit when duplicating a warehouse, its operation types (picking.type)
wouldn't get copied. This commit ensures that new picking.types are created for
the duplicate warehouse.

[Reproduce]
- run odoo 17 with -i stock,mrp_subcontracting
- in Inventory/Configuration/Warehouses Duplicate a Warehouse
- Bug: in  Inventory/Configuration/OperationTypes picking types aren't duplicated
opw-3674614

closes odoo/odoo#156542

X-original-commit: c8dd587c28e15e0a2a57bb95938a1109d99fc648
Signed-off-by: William Henrotin (whe) <whe@odoo.com>

================================= pseudo patch: =================================

--- a/addons/mrp/models/stock_warehouse.py
+++ b/addons/mrp/models/stock_warehouse.py
@@ -13,13 +13,13 @@ class StockWarehouse(models.Model):
         'Manufacture to Resupply', default=True,
         help="When products are manufactured, they can be manufactured in this warehouse.")
     manufacture_pull_id = fields.Many2one(
-        'stock.rule', 'Manufacture Rule')
+        'stock.rule', 'Manufacture Rule', copy=False)
     manufacture_mto_pull_id = fields.Many2one(
-        'stock.rule', 'Manufacture MTO Rule')
+        'stock.rule', 'Manufacture MTO Rule', copy=False)
     pbm_mto_pull_id = fields.Many2one(
-        'stock.rule', 'Picking Before Manufacturing MTO Rule')
+        'stock.rule', 'Picking Before Manufacturing MTO Rule', copy=False)
     sam_rule_id = fields.Many2one(
-        'stock.rule', 'Stock After Manufacturing Rule')
+        'stock.rule', 'Stock After Manufacturing Rule', copy=False)
     manu_type_id = fields.Many2one(
         'stock.picking.type', 'Manufacturing Operation Type',
         domain="[('code', '=', 'mrp_operation'), ('company_id', '=', company_id)]", check_company=True)
@@ -37,7 +37,7 @@ class StockWarehouse(models.Model):
         the components from the Stock to Input location first, and then\
         transfer it to the Production location.")
 
-    pbm_route_id = fields.Many2one('stock.route', 'Picking Before Manufacturing Route', ondelete='restrict')
+    pbm_route_id = fields.Many2one('stock.route', 'Picking Before Manufacturing Route', ondelete='restrict', copy=False)
 
     pbm_loc_id = fields.Many2one('stock.location', 'Picking before Manufacturing Location', check_company=True)
     sam_loc_id = fields.Many2one('stock.location', 'Stock after Manufacturing Location', check_company=True)
