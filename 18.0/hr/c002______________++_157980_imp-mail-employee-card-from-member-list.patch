PR: https://github.com/odoo/odoo/pull/157980

From: 7ccf39a0f2ba069e56f6066628339dcb401f9109
From: zel-odoo
Date: 2024-05-21 15:53:25

Structural Changes: 4
Total Changes: 12

[IMP] mail,*: employee card from member list

[Mail]
1. Open card from members list for channels, livechat channels, groups;

[Employees]
1. Add work location + corresponding icon after the phone number,
if specified;
2. Linting changes;

task-3710112

closes odoo/odoo#157980

Related: odoo/enterprise#59155
Related: odoo/upgrade#6042
Signed-off-by: SÃ©bastien Theys (seb) <seb@odoo.com>

================================= pseudo patch: =================================

--- a/addons/hr/models/hr_employee_base.py
+++ b/addons/hr/models/hr_employee_base.py
@@ -40,6 +40,11 @@ class HrEmployeeBase(models.AbstractModel):
     email = fields.Char(related="user_id.email")
     work_contact_id = fields.Many2one('res.partner', 'Work Contact', copy=False)
     work_location_id = fields.Many2one('hr.work.location', 'Work Location', domain="[('address_id', '=', address_id)]")
+    work_location_name = fields.Char("Work Location Name", compute="_compute_work_location_name_type")
+    work_location_type = fields.Selection([
+        ("home", "Home"),
+        ("office", "Office"),
+        ("other", "Other")], compute="_compute_work_location_name_type")
     user_id = fields.Many2one('res.users')
     share = fields.Boolean(related='user_id.share')
     resource_id = fields.Many2one('resource.resource')
@@ -94,6 +99,11 @@ class HrEmployeeBase(models.AbstractModel):
         op = 'in' if value and operator == '=' or not value and operator != '=' else 'not in'
         return [('id', op, new_hires.ids)]
 
+    @api.depends("work_location_id.name", "work_location_id.location_type")
+    def _compute_work_location_name_type(self):
+        for employee in self:
+            employee.work_location_name = employee.work_location_id.name or None
+            employee.work_location_type = employee.work_location_id.location_type or 'other'
 
     def _get_valid_employee_for_user(self):
         user = self.env.user

--- a/addons/hr/models/res_users.py
+++ b/addons/hr/models/res_users.py
@@ -95,6 +95,8 @@ class User(models.Model):
     address_id = fields.Many2one(related='employee_id.address_id', readonly=False, related_sudo=False)
     work_contact_id = fields.Many2one(related='employee_id.work_contact_id', readonly=False, related_sudo=False)
     work_location_id = fields.Many2one(related='employee_id.work_location_id', readonly=False, related_sudo=False)
+    work_location_name = fields.Char(related="employee_id.work_location_name")
+    work_location_type = fields.Selection(related="employee_id.work_location_type")
     employee_parent_id = fields.Many2one(related='employee_id.parent_id', readonly=False, related_sudo=False)
     coach_id = fields.Many2one(related='employee_id.coach_id', readonly=False, related_sudo=False)
     private_street = fields.Char(related='employee_id.private_street', string="Private Street", readonly=False, related_sudo=False)
