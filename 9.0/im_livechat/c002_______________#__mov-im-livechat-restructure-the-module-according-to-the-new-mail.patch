PR: https://github.com/odoo/odoo/pull/

From: 1d54858cbdd10dd6fbfbb3edc1e032317e2ba3f6
From: JÃ©rome Maes
Date: 2015-09-01 18:16:09

Structural Changes: 1
Total Changes: 176

[MOV] im_livechat : restructure the module according to the new mail module

================================= pseudo patch: =================================

--- a/addons/im_livechat/models/__init__.py
+++ b/addons/im_livechat/models/__init__.py
@@ -1,4 +1,4 @@
 # -*- coding: utf-8 -*
 import im_livechat_channel
-import im_chat_session
+import mail_channel
 import rating

--- a/addons/im_livechat/models/im_livechat_channel.py
+++ b/addons/im_livechat/models/im_livechat_channel.py
@@ -38,7 +38,6 @@ class ImLivechatChannel(models.Model):
         help="URL to a static page where you client can discuss with the operator of the channel.")
     are_you_inside = fields.Boolean(string='Are you inside the matrix?',
         compute='_are_you_inside', store=False, readonly=True)
-    script_internal = fields.Text('Script (internal)', compute='_compute_script_internal', store=False, readonly=True)
     script_external = fields.Text('Script (external)', compute='_compute_script_external', store=False, readonly=True)
     nbr_session = fields.Integer('Number of session', compute='_compute_nbr_session', store=False, readonly=True)
     rating_percentage_satisfaction = fields.Integer('% Happy', compute='_compute_percentage_satisfaction', store=False, default=-1)
@@ -75,17 +74,6 @@ class ImLivechatChannel(models.Model):
             self.image_small = False
             self.image_medium = False
 
-    @api.multi
-    def _compute_script_internal(self):
-        view = self.env['ir.model.data'].get_object('im_livechat', 'internal_loader')
-        values = {
-            "url": self.env['ir.config_parameter'].sudo().get_param('web.base.url'),
-            "dbname": self._cr.dbname,
-        }
-        for record in self:
-            values["channel"] = record.id
-            record.script_internal = view.render(values)
-
     @api.multi
     def _compute_script_external(self):
         view = self.env['ir.model.data'].get_object('im_livechat', 'external_loader')

--- a/addons/im_livechat/models/im_chat_session.py
+++ b/addons/im_livechat/models/mail_channel.py
