PR: https://github.com/odoo/odoo/pull/

From: 634821c68868678127f4aff9a85b1aa525cc1d1f
From: Thibault Delavall√©e
Date: 2017-03-23 12:11:34

Structural Changes: 4
Total Changes: 9

[IMP] mail: correctly use alias mixin on channel model

Currently channel model manually defines alias and inherits instead of
using the alias.mixin. This commit proposes to use alias feature through
the mixin to have a standard behavior.

================================= pseudo patch: =================================

--- a/addons/mail/models/mail_channel.py
+++ b/addons/mail/models/mail_channel.py
@@ -35,8 +35,7 @@ class Channel(models.Model):
     _name = 'mail.channel'
     _mail_flat_thread = False
     _mail_post_access = 'read'
-    _inherit = ['mail.thread']
-    _inherits = {'mail.alias': 'alias_id'}
+    _inherit = ['mail.thread', 'mail.alias.mixin']
 
     MAX_BOUNCE_LIMIT = 10
 
@@ -82,9 +81,6 @@ class Channel(models.Model):
         help="Small-sized photo of the group. It is automatically "
              "resized as a 64x64px image, with aspect ratio preserved. "
              "Use this field anywhere a small image is required.")
-    alias_id = fields.Many2one(
-        'mail.alias', 'Alias', ondelete="restrict", required=True,
-        help="The email address associated with this group. New emails received will automatically create new topics.")
     is_subscribed = fields.Boolean(
         'Is Subscribed', compute='_compute_is_subscribed')
 
@@ -145,6 +141,9 @@ class Channel(models.Model):
             self._subscribe_users()
         return result
 
+    def get_alias_model_name(self, vals):
+        return vals.get('alias_model', 'mail.channel')
+
     def _subscribe_users(self):
         for mail_channel in self:
             mail_channel.write({'channel_partner_ids': [(4, pid) for pid in mail_channel.mapped('group_ids').mapped('users').mapped('partner_id').ids]})
