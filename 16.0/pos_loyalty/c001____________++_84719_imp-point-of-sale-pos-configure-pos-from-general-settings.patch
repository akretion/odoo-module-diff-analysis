PR: https://github.com/odoo/odoo/pull/84719

From: fa111d449d843a365a81af5d1b0df75c3954a17b
From: Joseph Caburnay
Date: 2022-06-03 14:39:51

Structural Changes: 7
Total Changes: 26

[IMP] point_of_sale,*pos*: configure pos from general settings

Purpose:

- Move PoS settings in general settings to be consistent with the rest
  of Odoo (PoS being the only app where settings are split in two locations)
- Clean settings by enabling obvious settings or dropping unnecessary ones.

closes odoo/odoo#84719

Task-id: 2753430
Related: odoo/upgrade#3260
Related: odoo/enterprise#24425
Signed-off-by: Masereel Pierre <pim@odoo.com>

================================= pseudo patch: =================================

--- a/addons/pos_loyalty/models/__init__.py
+++ b/addons/pos_loyalty/models/__init__.py
@@ -10,3 +10,4 @@ from . import pos_config
 from . import pos_order_line
 from . import pos_order
 from . import pos_session
+from . import res_config_settings

--- a/None
+++ b/addons/pos_loyalty/models/res_config_settings.py
@@ -0,0 +1,25 @@
+# -*- coding: utf-8 -*-
+
+from odoo import fields, models, api
+
+
+class ResConfigSettings(models.TransientModel):
+    _inherit = 'res.config.settings'
+
+    pos_loyalty_program_id = fields.Many2one('loyalty.program', compute='_compute_pos_loyalty_id', store=True, readonly=False, pos='loyalty_program_id')
+
+    pos_use_coupon_programs = fields.Boolean(related='pos_config_id.use_coupon_programs', readonly=False)
+    pos_coupon_program_ids = fields.Many2many(related='pos_config_id.coupon_program_ids', readonly=False)
+    pos_promo_program_ids = fields.Many2many(related='pos_config_id.promo_program_ids', readonly=False)
+
+    pos_use_gift_card = fields.Boolean(related='pos_config_id.use_gift_card', readonly=False, string="Gift Cards (PoS)")
+    pos_gift_card_program_id = fields.Many2one(related='pos_config_id.gift_card_program_id', readonly=False)
+    pos_gift_card_settings = fields.Selection(related='pos_config_id.gift_card_settings', readonly=False)
+
+    @api.depends('pos_module_pos_loyalty', 'pos_config_id')
+    def _compute_pos_loyalty_id(self):
+        for res_config in self:
+            if res_config.pos_module_pos_loyalty:
+                res_config.pos_loyalty_program_id = res_config.pos_config_id.loyalty_program_id or res_config.pos_config_id._default_loyalty_program()
+            else:
+                res_config.pos_loyalty_program_id = False
